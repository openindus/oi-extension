<!DOCTYPE html>
<html lang="en">

    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>System configuration</title>
        <link href="style.css" rel="stylesheet" type="text/css" />
    </head>

    <body>

        <h1 id="test">Stepper configuration</h1>

        <h2>Connexion</h2>
        <label for="port">Port :</label>
        <input id="port" name="port">
        <button id="connect" onclick="connect()">Connect</button>
        <button id="disconnect" onclick="disconnect()">Disconnect</button>
        <button id="refresh" onclick="refresh()">Refresh</button>

        <h2>Constant speed command</h2>
        <label for="runDirection">Direction</label>
        <input id="runDirection" name="runDirection" list="direction" value="FORWARD">
        <label for="runSpeed">Speed</label>
        <input id="runSpeed" name="runSpeed" type="number" min="0" max="10000" value="200">
        <button onclick="cmdRun()">RUN</button>

        <h2>Relative move command</h2>
        <label for="moveRelativeDirection">Direction</label>
        <input name="moveRelativeDirection" list="direction" value="FORWARD">
        <button onclick="cmdMoveRelative()">MOVE RELATIVE</button>

        <h2>Absolute speed command</h2>
        <label for="moveAbsoluteDirection">Direction</label>
        <input name="moveAbsoluteDirection" list="direction" value="FORWARD">
        <button onclick="cmdMoveAbsolute()">MOVE ABSOLUTE</button>

        <h2>Homing command</h2>
        <button onclick="cmdHoming()">HOMING</button>

        <h2>Stop command</h2>
        <button onclick="cmdStop()">STOP</button>
        
        <datalist id="direction">
            <option value="FORWARD"></option>
            <option value="BACKWARD"></option>
        </datalist>

    </body>

    <script type="text/javascript">
        
        const vscode = acquireVsCodeApi();

        // By default disconnect is hidden
        document.getElementById("disconnect").style.display = "none";

        window.addEventListener('message', event => {
            switch(event.data.command) {
                case 'connect':
                    if (event.data.response === true) {
                        document.getElementById("connect").style.display = "none";
                        document.getElementById("disconnect").style.display = "inline";
                    }
                    break;
                case 'disconnect':
                    if (event.data.response === true) {
                        document.getElementById("connect").style.display = "inline";
                        document.getElementById("disconnect").style.display = "none";
                    }
                    break;
                case 'list':
                    break;
                case 'cmd':
                    break;
            }
        });
        
        function connect() {
            let port = document.getElementById("port").value;
            vscode.postMessage({
                command: 'connect',
                portName: port
            });
        }

        function disconnect() {
            vscode.postMessage({
                command: 'disconnect'
            });
        }

        function refresh() {
            vscode.postMessage({
                command: 'list'
            });
        }

        function cmdRun(args) {
            let speed = document.getElementById('runSpeed').value;
            let direction = document.getElementById('runDirection').value;
            vscode.postMessage({
                command: 'cmd',
                args: ['run', '2', direction==="FORWARD"?"1":"0", speed]
            });
        }

        function cmdStop(args) {
            vscode.postMessage({
                command: 'cmd',
                args: ['stop', '2']
            });
        }


    </script>
</html>