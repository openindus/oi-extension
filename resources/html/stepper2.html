<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System configuration</title>
    <link href="${content}/style2.css" rel="stylesheet" />
    <script type="module" src="https://unpkg.com/@vscode/webview-ui-toolkit/dist/toolkit.min.js"></script>
</head>

<body>
    <!-- <img src="${content}/openindus_logo.png" alt="OpenIndus Logo" class="logo"> -->
    <div class="presentation-text">
        <h1>OIStepper configuration tool</h1>
        <p>
            This interface allow you to configure and test paramters of OIStepper module. 
            You can control an OIStepper by connecting an USB cable directly to it or by connecting the USB cable to a master module which is on the same rail. 
            Keep in mind that the OIStepper must be powerer on by it termminal block to function normally. 
            Parameters in the section "configure motor" are same in the NVS (non-valative memory) of the module. 
            Limit switches can be configured for testing purpose but are not persistant accros reboot. 
            So be sure to set them into your application code.
        </p>
    </div>
    <div class="main-flex">

        <div class="flex-col flex-col-big">

            <div class="flex-block toggle-view" onclick="changeView(this)">
                <h2 class="h2select">Connexion</h2>
            </div>

            <div class="flex-block" id="connexion">
                <label for="port">Port :</label>
                <select id="port" name="port"></select>
                <vscode-button id="connect" onclick="connect()">Connect</vscode-button>
                <vscode-button id="disconnect" onclick="disconnect()">Disconnect</vscode-button>
                <vscode-button id="refresh" onclick="refresh()" title="Refresh">
                    <img src="${content}/refresh_logo.png" alt="Refresh">
                </vscode-button>
            </div>

            <div class="flex-block toggle-view" id="motor-move-title" onclick="changeView(this)">
                <h2 class="h2select">Test motor</h2>
            </div>

            <div class="flex-block" id="motor-move">
                
                <p><i>In this mode, you can try your motor with several commands. It will help you to tune motor parameters. 
                    You can move the two motors at the sem time or move them one by one.
                    before issuing a "homing" command, you must set a limit-switch for the motor</i></p>
                
                <vscode-radio-group name="motor-move-selection">
                    <label slot="label">Select the motor to parameter</label>
                    <vscode-radio value="1">Motor 1</vscode-radio>
                    <vscode-radio value="2">Motor 2</vscode-radio>
                    <vscode-radio value="3">Motor 1+2</vscode-radio>
                </vscode-radio-group>

                <div class="flex-command">
                    <vscode-button onclick="cmdRun()">Run</vscode-button>
                    <label for="runSpeed">Speed :</label>
                    <input id="runSpeed" name="runSpeed" type="number" min="0" max="10000" value="200">
                    <label for="runDirection">Direction :</label>
                    <select id="runDirection" name="runDirection" list="direction" value="FORWARD">
                        <option value="FORWARD">Forward</option>
                        <option value="BACKWARD">Backward</option>
                    </select>
                </div>
                
                <div class="flex-command">
                    <vscode-button onclick="cmdMoveRelative()">Move relative</vscode-button>
                    <label for="moveRelativeStep">Steps :</label>
                    <input id="moveRelativeStep" name="moveRelativeStep" type="number" min="-100000" max="100000" value="0">
                </div>
                
                <div class="flex-command">
                    <vscode-button onclick="cmdMoveAbsolute()">Move absolute</vscode-button>
                    <label for="moveAbsoluteStep">Steps :</label>
                    <input id="moveAbsoluteStep" name="moveAbsoluteStep" type="number" min="0" max="100000" value="0">
                </div>
                
                <div class="flex-command">
                    <vscode-button onclick="cmdHoming()">Homing</vscode-button>
                    <label for="homingSpeed">Speed :</label>
                    <input id="homingSpeed" name="homingSpeed" type="number" min="0" max="10000" value="200">
                </div>
                
                <div class="flex-command">
                    <vscode-button onclick="cmdStop()" class="red-vscode-button">Stop</vscode-button>
                    <label for="stopMode">Mode :</label>
                    <select id="stopMode" name="stopMode" list="mode" value="soft-hiz">
                        <option value="soft-hiz">Soft Hiz</option>
                        <option value="soft-stop">Soft Stop</option>
                        <option value="hard-hiz">Hard Hiz</option>
                        <option value="hard-stop">Hard Stop</option>
                    </select>
                </div>
            </div>

            <div class="flex-block toggle-view" id="motor-configuration-title" onclick="changeView(this)">
                <h2 class="h2select">Configure motor</h2>
            </div>

            <div class="flex-block"  id="motor-configuration">

                <p>
                    <i>Configure your motor with the parameters below.
                    Your motor have to be in HiZ (see flags) toconfigure motor parameters.
                    The first time you configure a motor, we recommend to click the "Reset parameters" vscode-button to set all parameters to their default values.
                    If you want to change a parameter, you can change it and click the "Set parameters" vscode-button.
                    Before modifiyng a paramter, click the "Get parameters" vscode-button to get the current values.</i>
                </p>

                <vscode-radio-group name="motor-configure-selection">
                    <label slot="label">Select the motor to parameter</label>
                    <vscode-radio value="1">Motor 1</vscode-radio>
                    <vscode-radio value="2">Motor 2</vscode-radio>
                </vscode-radio-group>

                <div class="flex-command">
                    <vscode-button onclick="getParameters()">Get</vscode-button>
                    <vscode-button onclick="resetParameters()">Reset</vscode-button>
                    <vscode-button onclick="setParameters()">Set</vscode-button>
                    <vscode-button onclick="saveParameters()">Save to file</vscode-button>
                    <vscode-button onclick="loadParameters()">Load from file</vscode-button>
                </div>

                <div class="flex-command">
                    <label for="max-speed">Maximum Speed (step/s) :</label>
                    <input id="max-speed" name="max-speed" type="number" min="15" max="15610" value="992" step="15">
                    <vscode-button><img src="${content}/info.png"></vscode-button>
                    <p><i>This is the target speed for relative and absolute move command. This is the maximum speed for run command</i></p>
                </div>

                <div class="flex-command">
                    <label for="acc">Acceleration Speed (step/s²) :</label>
                    <input id="acc" name="acc" type="number" min="0" max="59575" value="2008" step="15">
                </div>

                <div class="flex-command">
                    <label for="dec">Deceleration Speed (step/s²) :</label>
                    <input id="dec" name="dec" type="number" min="0" max="59590" value="2008" step="15">
                </div>

                <div class="flex-command">
                    <label for="step-mode-step-sel">Step mode :</label>
                    <select id="step-mode-step-sel" name="step-mode-step-sel">
                        <option value="0">FULL</option>
                        <option value="1">1/2</option>
                        <option value="2">1/4</option>
                        <option value="3">1/8</option>
                        <option value="4" selected>1/16</option>
                        <option value="5">1/32</option>
                        <option value="6">1/64</option>
                        <option value="7">1/128</option>
                    </select>
                </div>

                <div class="flex-command">
                    <label for="kval-hold">Kval hold :</label>
                    <input id="kval-hold" name="kval-hold" type="number" min="1" max="99" value="16" step="1">
                </div>

                <div class="flex-command">
                    <label for="kval-run">Kval run :</label>
                    <input id="kval-run" name="kval-run" type="number" min="1" max="99" value="16" step="1">
                </div>

                <div class="flex-command">
                    <label for="kval-acc">Kval acceleration :</label>
                    <input id="kval-acc" name="kval-acc" type="number" min="1" max="99" value="16" step="1">
                </div>

                <div class="flex-command">
                    <label for="kval-dec">Kval deceleration :</label>
                    <input id="kval-dec" name="kval-dec" type="number" min="1" max="99" value="16" step="1">
                </div>

                <div class="flex-command">
                    <label for="f-slp-acc">Back-EMF compensation :</label>
                    <input id="f-slp-acc" name="f-slp-acc" type="number" min="0" max="0.4" value="0.06256" step="0.0015">
                </div>

                <div class="flex-command">
                    <label for="ocd-th">Over-current threshold (A) :</label>
                    <select id="ocd-th" name="ocd-th">
                        <option value="0">2</option>
                        <option value="1">4</option>
                        <option value="2">6</option>
                        <option value="3">8</option>
                        <option value="4" selected>10</option>
                        <option value="5">12</option>
                        <option value="6">14</option>
                        <option value="7">16</option>
                        <option value="8">18</option>
                        <option value="9">20</option>
                        <option value="10">22</option>
                        <option value="11">24</option>
                        <option value="12">26</option>
                        <option value="13">28</option>
                        <option value="14">30</option>
                    </select>
                </div>

                <div class="flex-command">
                    <label for="stall-th">Stall threshold (A) :</label>
                    <select id="stall-th" name="stall-th">
                        <option value="0">0.7</option>
                        <option value="1">1.3</option>
                        <option value="2">2</option>
                        <option value="3">2.7</option>
                        <option value="4">3.4</option>
                        <option value="5">4</option>
                        <option value="6">4.7</option>
                        <option value="7">5.4</option>
                        <option value="8">6.1</option>
                        <option value="9">6.8</option>
                        <option value="10">7.4</option>
                        <option value="11">8.1</option>
                        <option value="12">8.8</option>
                        <option value="13">9.5</option>
                        <option value="14" selected>10.2</option>
                    </select>
                </div>
            </div>

            <div class="flex-block toggle-view" id="motor-switches-title" onclick="changeView(this)">
                <h2 class="h2select">Configure limit-switch</h2>
            </div>

            <div class="flex-block" id="motor-switches">
                <p><i>Configure limit swicthes below for testing purposer. Limit switches are resetted when the program restart.<br>
                Limit switches have to be configured in the init sequence of our main program.</i></p>
                <div>
                    <div class="flex-command">
                        <label for="limit-switch-motor">Motor :</label>
                        <select id="limit-switch-motor" name="limit-switch-motor">
                            <option value="1">Motor 1</option>
                            <option value="2">Motor 2</option>
                        </select>
                        <label for="limit-switch-input">Input :</label>
                        <select id="limit-switch-input" name="limit-switch-input">
                            <option value="0" selected>---</option>
                            <option value="1">DIN 1</option>
                            <option value="2">DIN 2</option>
                            <option value="3">DIN 3</option>
                            <option value="4">DIN 4</option>
                        </select>
                        <label for="limit-switch-logic">Logic :</label>
                        <select id="limit-switch-logic" name="limit-switch-logic">
                            <option value="1" selected>Active HIGH</option>
                            <option value="0">Active LOW</option>
                        </select>
                    </div>
                    <div class="flex-command"></div>
                        <vscode-button id="attach-limit-switch" onclick="setLimitSwitch(1)">Attach</vscode-button>
                        <vscode-button id="dettach-limit-switch" onclick="setLimitSwitch(0)">Dettach</vscode-button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="side-nav">
        <div class="flex-block" id="motor-status">
            <h2>Motors status</h2>
            <vscode-button onclick="getStatus()">Get status</vscode-button>
            <vscode-button onclick="clearStatus()">Clear status</vscode-button>
            <div class="large-width">
                <input type="checkbox" id="autoPoolStatus" name="autoPoolStatus" checked>
                <label for="autoPoolStatus">Auto pool status</label>
            </div>
            <div id="statusList">
                <table>
                    <tr>
                        <th></th>
                        <th>Motor 1</th>
                        <th>Motor 2</th>
                    </tr>
                    <tr>
                        <td class="right-align">Command error</td>
                        <td><img id="alarm-cmd-error-1" src="${content}/circle_empty.png"></td>
                        <td><img id="alarm-cmd-error-2" src="${content}/circle_empty.png"></td>
                    </tr>
                    <tr>
                        <td class="right-align">Undervoltage</td>
                        <td><img id="alarm-uvlo-1" src="${content}/circle_empty.png"></td>
                        <td><img id="alarm-uvlo-2" src="${content}/circle_empty.png"></td>
                    </tr>
                    <tr>
                        <td class="right-align">Thermal Shutdown</td>
                        <td><img id="alarm-thermal-shutdown-1" src="${content}/circle_empty.png"></td>
                        <td><img id="alarm-thermal-shutdown-2" src="${content}/circle_empty.png"></td>
                    </tr>
                    <tr>
                        <td class="right-align">Thermal warning</td>
                        <td><img id="alarm-thermal-warning-1" src="${content}/circle_empty.png"></td>
                        <td><img id="alarm-thermal-warning-2" src="${content}/circle_empty.png"></td>
                    </tr>
                    <tr>
                        <td class="right-align">Overcurrent</td>
                        <td><img id="alarm-ocd-1" src="${content}/circle_empty.png"></td>
                        <td><img id="alarm-ocd-2" src="${content}/circle_empty.png"></td>
                    </tr>
                    <tr>
                        <td class="right-align">Stall</td>
                        <td><img id="alarm-stall-1" src="${content}/circle_empty.png"></td>
                        <td><img id="alarm-stall-2" src="${content}/circle_empty.png"></td>
                    </tr>
                    <tr>
                        <td class="right-align">Motor runnning</td>
                        <td><img id="alarm-motor-running-1" src="${content}/circle_empty.png"></td>
                        <td><img id="alarm-motor-running-2" src="${content}/circle_empty.png"></td>
                    </tr>
                    <tr>
                        <td class="right-align">Busy</td>
                        <td><img id="alarm-busy-1" src="${content}/circle_empty.png"></td>
                        <td><img id="alarm-busy-2" src="${content}/circle_empty.png"></td>
                    </tr>
                    <tr>
                        <td class="right-align">HiZ</td>
                        <td><img id="alarm-hiz-1" src="${content}/circle_empty.png"></td>
                        <td><img id="alarm-hiz-2" src="${content}/circle_empty.png"></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
</body>

<script type="text/javascript">

    /* Page dynamix content display */

    function changeView(element) {
        elementChild = element.firstElementChild;
        if (elementChild.classList.contains("h2select")) {
            elementChild.classList.remove("h2select");
            elementChild.classList.add("h2notselect");
            element.nextElementSibling.style.display = "none";
        } else {
            elementChild.classList.remove("h2notselect");
            elementChild.classList.add("h2select");
            element.nextElementSibling.style.display = "block";
        }
    }

    function hideContentOneByOne() {
        setTimeout(() => {
            changeView(document.getElementById("motor-move-title"));
        }, 500);
        setTimeout(() => {
            changeView(document.getElementById("motor-configuration-title"));
        }, 500);
        setTimeout(() => {
            changeView(document.getElementById("motor-switches-title"));
        }, 500);
    }

    window.addEventListener('DOMContentLoaded', hideContentOneByOne);

    function adjustSideNavTop() {
        var presentation = document.querySelector('.presentation-text');
        var sideNav = document.querySelector('.side-nav');
        if (presentation && sideNav) {
            var rect = presentation.getBoundingClientRect();
            sideNav.style.top = (rect.bottom >0?rect.bottom:0) + 'px';
        }
    }

    window.addEventListener('DOMContentLoaded', adjustSideNavTop);
    window.addEventListener('resize', adjustSideNavTop);
    window.addEventListener('scroll', adjustSideNavTop);

    /* Communication with extension */

    const vscode = acquireVsCodeApi();
    var paramList = {};
    var circle_empty_png = "${content}/circle_empty.png";
    var circle_green_png = "${content}/circle_green.png";
    var circle_red_png = "${content}/circle_red.png";
    var circle_orange_png = "${content}/circle_orange.png";
    var refreshStatusInterval = null;

    // By default disconnect is hidden
    document.getElementById("disconnect").style.display = "none";

    // By default there is only on limit switch to homing command
    document.getElementById("limit-switch-2").style.display = "none";
    document.getElementById("limit-switch-2-label").style.display = "none";

    // When autoPoolStatus is check, start autopooling
    document.getElementById("autoPoolStatus").addEventListener('change', function() {
        if (this.checked) {
            refreshStatusInterval = setInterval(getStatus, 500);
        } else {
            clearInterval(refreshStatusInterval);
        }
    });
    
    window.addEventListener('message', event => {
        switch(event.data.command) {
            case 'connect':
                if (event.data.response === true) {
                    document.getElementById("connect").style.display = "none";
                    document.getElementById("disconnect").style.display = "inline";
                    if (document.getElementById("autoPoolStatus").checked) {
                        refreshStatusInterval = setInterval(getStatus, 500);
                    }
                }
                break;
            case 'disconnect':
                // If data.response is true OR false, display connect vscode-button anyway
                document.getElementById("connect").style.display = "inline";
                document.getElementById("disconnect").style.display = "none";
                clearInterval(refreshStatusInterval);
                break;
            case 'list':
                let select_port = document.getElementById('port');
                console.log(event.data.response);
                for (port of event.data.response) {
                    console.log(port);
                    let opt = document.createElement('option');
                    opt.value = port.port + ';' + port.serialNum + ';' + port.id;
                    opt.innerHTML = port.port + " - OIStepper n°" + port.serialNum;
                    if (port.onBus === true) {
                        opt.innerHTML += " (on bus)";
                        opt.value += ";true";
                    } else {
                        opt.value += ";false";
                    }
                    select_port.appendChild(opt);
                }
                if (event.data.response.length === 0) {
                    let opt = document.createElement('option');
                    opt.value = "";
                    opt.innerHTML = "No OIStepper found";
                    select_port.appendChild(opt);
                }
                break;
            case 'get-parameters':
            case 'load-parameters':
                if (event.data.response) {
                    console.log(event.data.response);
                    paramList = event.data.response;
                    document.getElementById("max-speed").value = event.data.response['max-speed'].split('.')[0];
                    document.getElementById("acc").value = event.data.response['acc'].split('.')[0];
                    document.getElementById("dec").value = event.data.response['dec'].split('.')[0];
                    document.getElementById("step-mode-step-sel").value = event.data.response['step-mode-step-sel'];
                    document.getElementById("kval-hold").value = event.data.response['kval-hold'].split('.')[0];
                    document.getElementById("kval-run").value = event.data.response['kval-run'].split('.')[0];
                    document.getElementById("kval-acc").value = event.data.response['kval-acc'].split('.')[0];
                    document.getElementById("kval-dec").value = event.data.response['kval-dec'].split('.')[0];
                    document.getElementById("fn-slp-acc").value = event.data.response["fn-slp-acc"];
                    document.getElementById("ocd-th").value = event.data.response['ocd-th']/31.25; // Convert from mV
                    document.getElementById("stall-th").value = event.data.response['stall-th']/31.25; // Convert from mV
                }
                break;
            case 'set-parameters':
                if (event.data.response) {
                    console.log("Parameters set successfully");
                    getParameters();
                } else {
                    console.error("Failed to set parameters");
                }
                break;
            case 'reset-parameters':
                if (event.data.response) {
                    console.log("Parameters reset successfully");
                    getParameters();
                } else {
                    console.error("Failed to reset parameters");
                }
                break;
            case 'get-status':
                if (event.data.response) {
                    console.log(event.data.response);
                    // Update flags
                    for (let i = 0; i < 2; i++) {
                        if (event.data.response[i] !== undefined) {
                            console.log(event.data.response[i]['cmd-error']);
                            document.getElementById("alarm-cmd-error-" + (i+1).toString()).src = event.data.response[i]['cmd-error'] == 1 ? circle_red_png : circle_empty_png;
                            document.getElementById("alarm-uvlo-" + (i+1).toString()).src = event.data.response[i]['uvlo'] == 0 ? circle_red_png : circle_empty_png;
                            document.getElementById("alarm-thermal-shutdown-" + (i+1).toString()).src = event.data.response[i]['thermal_shutdown'] == 1 ? circle_red_png : circle_empty_png;
                            document.getElementById("alarm-thermal-warning-" + (i+1).toString()).src = event.data.response[i]['thermal_warning'] == 1 ? circle_red_png : circle_empty_png;
                            document.getElementById("alarm-ocd-" + (i+1).toString()).src = event.data.response[i]['ocd'] == 0 ? circle_red_png : circle_empty_png;
                            document.getElementById("alarm-stall-" + (i+1).toString()).src = (event.data.response[i]['stall-a'] == 0 | event.data.response[i]['stall-b'] == 0) ? circle_red_png : circle_empty_png;
                            document.getElementById("alarm-motor-running-" + (i+1).toString()).src = event.data.response[i]['motor-running'] == 1 ? circle_orange_png : circle_empty_png;
                            document.getElementById("alarm-busy-" + (i+1).toString()).src = event.data.response[i]['busy'] == 0 ? circle_orange_png : circle_empty_png;
                            document.getElementById("alarm-hiz-" + (i+1).toString()).src = event.data.response[i]['hiz'] == 1 ? circle_green_png : circle_empty_png;
                        }
                    }
                }
            case 'cmd':
                break;
        }
    });
    
    function connect() {
        let port = document.getElementById("port").value;
        vscode.postMessage({
            command: 'connect',
            portName: port.split(';')[0],
            serialNum: port.split(';')[1],
            id: port.split(';')[2],
            onBus: port.split(';')[3] === 'true' ? true : false
        });
    }
    
    function disconnect() {
        vscode.postMessage({
            command: 'disconnect'
        });
    }
    
    function refresh() {
        if (document.getElementById("disconnect").style.display === "inline") {
            disconnect();
        }
        let select_port = document.getElementById('port');
        select_port.replaceChildren(); // delete existing options
        vscode.postMessage({
            command: 'list'
        });
    }

    function setLimitSwitch(setUnset) {
        let motor = document.getElementById('limit-switch-motor').value;
        let input = document.getElementById('limit-switch-input').value;
        let logic = document.getElementById('limit-switch-logic').value;
        if (input !== '0') {
            if (setUnset === 1) {
                vscode.postMessage({
                    command: 'cmd',
                    args: ['stepper-attach-limit-switch', motor, input, logic]
                });
            } else {
                vscode.postMessage({
                    command: 'cmd',
                    args: ['stepper-detach-limit-switch', motor, input]
                });
            }
        }
    }

    function getParameters() {
        let motor = document.getElementsByName("motor-configure-selection").value;
        vscode.postMessage({
            command: 'get-parameters',
            args: [motor]
        });
    }

    function setParameters() {
        let motor = document.getElementsByName("motor-configure-selection").value;

        paramList['max-speed'] = document.getElementById("max-speed").value,
        paramList['fs-spd'] = document.getElementById("max-speed").value, // This a hidden parameter which depends on max-speed
        paramList['acc'] = document.getElementById("acc").value,
        paramList['dec'] = document.getElementById("dec").value,
        paramList['step-mode-step-sel'] = document.getElementById("step-mode-step-sel").value,
        paramList['kval-hold'] = document.getElementById("kval-hold").value,
        paramList['kval-run'] = document.getElementById("kval-run").value,
        paramList['kval-acc'] = document.getElementById("kval-acc").value,
        paramList['kval-dec'] = document.getElementById("kval-dec").value,
        paramList['fn-slp-acc'] = document.getElementById("f-slp-acc").value,
        paramList['fn-slp-dec'] = document.getElementById("f-slp-acc").value, // This a hidden parameter which depends on fn-slp-acc
        paramList['st-slp'] = (document.getElementById("f-slp-acc").value/2).toString(), // This a hidden parameter which depends on fn-slp-acc
        paramList['ocd-th'] = (document.getElementById("ocd-th").value*31.25*4).toString(), // Convert to mV
        paramList['stall-th'] = (document.getElementById("stall-th").value*31.25).toString() // Convert to mV

        vscode.postMessage({
            command: 'set-parameters',
            args: [motor, paramList]
        });
    }

    function resetParameters() {
        let motor = document.getElementsByName("motor-configure-selection").value;
        vscode.postMessage({
            command: 'reset-parameters',
            args: [motor]
        });
    }

    function saveParameters() {
        vscode.postMessage({
            command: 'save-parameters',
            args: [paramList]
        });
    }

    function loadParameters() {
        vscode.postMessage({
            command: 'load-parameters',
            args: []
        });
    }
    
    function cmdRun() {
        let motor = document.getElementsByName("motor-move-selection").value;
        let direction = document.getElementById('runDirection').value;
        let speed = document.getElementById('runSpeed').value;
        if (motor === '1' || motor === '3') {
            vscode.postMessage({
                command: 'cmd',
                args: ['stepper-run', '1', direction==="FORWARD"?"1":"0", speed]
            });
        }
        if (motor === '2' || motor === '3') {
            vscode.postMessage({
                command: 'cmd',
                args: ['stepper-run', '2', direction==="FORWARD"?"1":"0", speed]
            });
        }
    }
    
    function cmdMoveRelative() {
        let motor = document.getElementsByName("motor-move-selection").value;
        let steps = document.getElementById('moveRelativeStep').value;
        if (motor === '1' || motor === '3') {
            vscode.postMessage({
                command: 'cmd',
                args: ['stepper-move-relative', '1', steps]
            });
        }
        if (motor === '2' || motor === '3') {
            vscode.postMessage({
                command: 'cmd',
                args: ['stepper-move-relative', '2', steps]
            });
        }
    }
    
    function cmdMoveAbsolute() {
        let motor = document.getElementsByName("motor-move-selection").value;
        let steps = document.getElementById('moveAbsoluteStep').value;
        if (motor === '1' || motor === '3') {
            vscode.postMessage({
                command: 'cmd',
                args: ['stepper-move-absolute', '1', steps]
            });
        }
        if (motor === '2' || motor === '3') {
            vscode.postMessage({
                command: 'cmd',
                args: ['stepper-move-absolute', '2', steps]
            });
        }
    }

    function cmdHoming() {
        let motor = document.getElementsByName("motor-move-selection").value;
        let speed = document.getElementById('homingSpeed').value;
        if (motor === '1' || motor === '3') {
            vscode.postMessage({
                command: 'cmd',
                args: ['stepper-homing', '1', speed]
            });
        }
        if (motor === '2' || motor === '3') {
            vscode.postMessage({
                command: 'cmd',
                args: ['stepper-homing', '2', speed]
            });
        }
    }
    
    function cmdStop() {
        let motor = document.getElementsByName("motor-move-selection").value;
        let mode = document.getElementById('stopMode').value;
        if (motor === '1' || motor === '3') {
            vscode.postMessage({
                command: 'cmd',
                args: ['stepper-stop', '1' , mode]
            });
        }
        if (motor === '2' || motor === '3') {
            vscode.postMessage({
                command: 'cmd',
                args: ['stepper-stop', '2' , mode]
            });
        }
    }

    function getStatus() {
        vscode.postMessage({
            command: 'get-status',
            args: []
        })
    }

    function clearStatus() {
        vscode.postMessage({
            command: 'cmd',
            args: ['stepper-clear-status', '1']
        });
        vscode.postMessage({
            command: 'cmd',
            args: ['stepper-clear-status', '2']
        });
    }
    
</script>
</html>